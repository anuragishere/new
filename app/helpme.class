package com.example.anurag.smssend;

import android.app.Activity;

import android.content.Context;
import android.content.SharedPreferences;
import android.location.Criteria;

import android.location.LocationListener;
import android.os.Bundle;
import android.telephony.SmsManager;
import android.location.Location;

import android.location.LocationManager;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;


public class helpme extends Activity {
 EditText phoneNumber;
 Button button5;



 public double lat;
 public double lon;
    @Override
    protected void onCreate(Bundle savedInstanceState) {

        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_helpme);
        phoneNumber=(EditText)findViewById(R.id.editText2);
        button5=(Button)findViewById(R.id.button5);


        LocationManager locationmanager =(LocationManager)getSystemService(Context.LOCATION_SERVICE);
        Criteria criteria = new Criteria();

        String provider = locationmanager.getBestProvider(criteria,true);
        Location myLocation = locationmanager.getLastKnownLocation(provider);

        LocationManager locationManager= (LocationManager)getSystemService(Context.LOCATION_SERVICE);
        LocationListener locationListener = new MyLocationListener();
        locationManager.requestLocationUpdates( LocationManager.GPS_PROVIDER, 0, 0, locationListener);




        button5.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

              String phone= phoneNumber.getText().toString();
                try {
                    SmsManager.getDefault().sendTextMessage(phone, null, "Need Emergency Help at Latitude"+helpme.this.lat+"Longitude"+helpme.this.lon, null, null);
                } catch (Exception e) {
                    Toast.makeText(helpme.this,"Sms not Send..", Toast.LENGTH_SHORT).show();


                }


            }
        });


    }

    public class MyLocationListener implements LocationListener {

        @Override
        public void onLocationChanged(Location loc) {
            lat = loc.getLatitude();
            lon = loc.getLongitude();
            String Text = "My current Latitude = " + lat  + " Longitude = " + lon;
            Toast.makeText( getApplicationContext(),Text,Toast.LENGTH_SHORT).show();
  //new

           // for send the  Query String of latitude and logintude to the webapp.
        }



        @Override
        public void onProviderDisabled(String provider) {
            Toast.makeText( getApplicationContext(),"Gps Disabled",Toast.LENGTH_SHORT ).show();
        }


        @Override
        public void onProviderEnabled(String provider) {
            Toast.makeText( getApplicationContext(),"Gps Enabled",Toast.LENGTH_SHORT).show();
        }


        @Override
        public void onStatusChanged(String provider, int status, Bundle extras) {
        }



    }/* End of Class MyLocationListener  this */






}

